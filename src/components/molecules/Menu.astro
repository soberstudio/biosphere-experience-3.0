---
import { siteInfo } from '../../data/SiteData';
import YoutubeIcon from '../../assets/icons/youtube.svg';
import InstagramIcon from '../../assets/icons/instagram.svg';
import LinkedInIcon from '../../assets/icons/linkedin.svg';
import Email from '../../assets/icons/email.svg';
import ThemeToggle from '../atoms/ThemeToggle.astro';
---

<div id="menu-overlay" class="menu-overlay"></div>
<nav id="menu" class="menu">
  <div class="flex flex-row items-center justify-between gap-2 border-b border-neutral-900 w-full px-8 py-3">
    <p class="mt-0">Contraste </p><ThemeToggle />
  </div>
  <ul class="flex flex-col gap-4 list-none ml-0 py-5 px-8 uppercase [&_a]:no-underline">
    <li><a href="/historique" class="tracking-widest hover:text-white">L'histoire biosphère</a></li>
    <li><a href="/biosphere-plateforme" class="tracking-widest hover:text-white">Biosphère plateforme</a></li>
    <li><a href="/biosphere-du-desert" class="tracking-widest hover:text-white">Biosphère du désert</a></li>
    <li><a href="/biosphere-urbaine" class="tracking-widest hover:text-white">Biosphère urbaine</a></li>
    <li><a href="/equipe-partenaires" class="tracking-widest hover:text-white">Équipe et partenaires</a></li>
    <li><a href="/site-eco-concu" class="tracking-widest hover:text-white">Site web éco-conçu</a></li>
  </ul>
  <ul class="flex gap-6 w-full justify-between items-center list-none ml-0 px-8 py-4 border-t border-neutral-900 social-links">
    <li>
      <a href={`mailto:${siteInfo.email}`} aria-label="Email">
        <Email width={25} height={25} fill="var(--theme-text)"/>
      </a>
    </li>
    <li>
      <a href={siteInfo.social.youtube} target="_blank" rel="noopener" aria-label="YouTube">
        <YoutubeIcon width={30} height={30} fill="var(--theme-text)"/>
      </a>
    </li>
    <li>
      <a href={siteInfo.social.instagram} target="_blank" rel="noopener" aria-label="Instagram">
        <InstagramIcon width={25} height={25} fill="var(--theme-text)"/>
      </a>
    </li>
    <li>
      <a href={siteInfo.social.linkedin} target="_blank" rel="noopener" aria-label="LinkedIn">
        <LinkedInIcon width={25} height={25} fill="var(--theme-text)"/>
      </a>
    </li>
  </ul>
</nav>

<script>
  const menuButton = document.getElementById('menu-toggle') as HTMLButtonElement;
  const menu = document.getElementById('menu') as HTMLElement;
  const overlay = document.getElementById('menu-overlay') as HTMLElement;

  function closeMenu() {
    menuButton?.setAttribute('aria-expanded', 'false');
    menu?.classList.remove('open');
    overlay?.classList.remove('open');
  }

  menuButton?.addEventListener('click', () => {
    const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
    menuButton.setAttribute('aria-expanded', String(!isExpanded));

    if (isExpanded) {
      menu?.classList.remove('open');
      overlay?.classList.remove('open');
    } else {
      menu?.classList.add('open');
      overlay?.classList.add('open');
    }
  });

  // Close menu on: nav links, Escape key, or outside click
  menu?.querySelectorAll('a').forEach(link => link.addEventListener('click', closeMenu));
  document.addEventListener('keydown', (e) => e.key === 'Escape' && menuButton?.getAttribute('aria-expanded') === 'true' && closeMenu());
  overlay?.addEventListener('click', closeMenu);
</script>

<style>
  .menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.65);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 997;
  }

  .menu-overlay.open {
    opacity: 1;
    pointer-events: auto;
  }

  .menu {

    position: fixed;
    top: 4rem;
    right: 0.75rem;
    display: flex;
    flex-direction: column;
    border-radius: 0.75rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    color: var(--theme-text);
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1000;
  }

  @media (min-width: 768px) {
    .menu {
      right: 1.5rem;
    }
  }

  .menu.open {
    opacity: 1;
    pointer-events: auto;
  }

  .social-links a:hover svg {
    fill: white;
  }
</style>
